<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Batch Launch Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      /* Default (dark) palette */
      --bg: #0f172a;
      --text: #e5e7eb;
      --card-bg: #020617;
      --border: #1f2937;
      --muted: #9ca3af;
      --muted-strong: #d1d5db;
      --pill-border: #4b5563;
      --error-text: #fecaca;
      --table-row-border: #111827;
      --calendar-cell-bg: #020617;
      --calendar-muted-text: #9ca3af;
      --calendar-other-month-opacity: 0.35;
    }

    /* Dark theme */
    body[data-theme="dark"] {
      --bg: #0f172a;
      --text: #e5e7eb;
      --card-bg: #020617;
      --border: #1f2937;
      --muted: #9ca3af;
      --muted-strong: #d1d5db;
      --pill-border: #4b5563;
      --error-text: #fecaca;
      --table-row-border: #111827;
      --calendar-cell-bg: #020617;
      --calendar-muted-text: #9ca3af;
      --calendar-other-month-opacity: 0.35;
    }

    /* Light theme */
    body[data-theme="light"] {
      --bg: #f3f4f6;
      --text: #111827;
      --card-bg: #ffffff;
      --border: #e5e7eb;
      --muted: #6b7280;
      --muted-strong: #4b5563;
      --pill-border: #9ca3af;
      --error-text: #b91c1c;
      --table-row-border: #e5e7eb;
      --calendar-cell-bg: #ffffff;
      --calendar-muted-text: #9ca3af;
      --calendar-other-month-opacity: 0.35;
    }

    /* Ocean theme */
    body[data-theme="ocean"] {
      --bg: #0b1120;
      --text: #e0f2fe;
      --card-bg: #020617;
      --border: #1e293b;
      --muted: #7dd3fc;
      --muted-strong: #bae6fd;
      --pill-border: #38bdf8;
      --error-text: #fecaca;
      --table-row-border: #0b1120;
      --calendar-cell-bg: #020617;
      --calendar-muted-text: #7dd3fc;
      --calendar-other-month-opacity: 0.35;
    }

    /* Emerald theme */
    body[data-theme="emerald"] {
      --bg: #022c22;
      --text: #d1fae5;
      --card-bg: #022c22;
      --border: #064e3b;
      --muted: #6ee7b7;
      --muted-strong: #a7f3d0;
      --pill-border: #10b981;
      --error-text: #fecaca;
      --table-row-border: #064e3b;
      --calendar-cell-bg: #022c22;
      --calendar-muted-text: #6ee7b7;
      --calendar-other-month-opacity: 0.35;
    }

    /* Sunset theme */
    body[data-theme="sunset"] {
      --bg: #111827;
      --text: #fef3c7;
      --card-bg: #1f2937;
      --border: #4b5563;
      --muted: #fbbf24;
      --muted-strong: #fed7aa;
      --pill-border: #f97316;
      --error-text: #fecaca;
      --table-row-border: #374151;
      --calendar-cell-bg: #111827;
      --calendar-muted-text: #fbbf24;
      --calendar-other-month-opacity: 0.4;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      max-width: 1000px;
      width: 100%;
      padding: 24px 16px 40px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 24px 20px 28px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.6);
      border: 1px solid var(--border);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    h1 {
      font-size: 1.6rem;
      margin: 0 0 4px;
      color: var(--text);
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--muted);
    }

    .theme-select-wrapper {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      min-width: 150px;
    }

    .theme-label {
      font-size: 0.75rem;
      color: var(--muted);
    }

    .theme-select {
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 4px 10px;
      font-size: 0.8rem;
      background: transparent;
      color: var(--muted-strong);
    }

    .theme-select:focus {
      outline: none;
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px #38bdf8;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 6px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 14px;
      margin-top: 4px;
    }

    .tab-btn {
      border: none;
      background: transparent;
      padding: 6px 12px;
      font-size: 0.85rem;
      cursor: pointer;
      color: var(--muted);
      border-bottom: 2px solid transparent;
      border-radius: 0;
      box-shadow: none;
      margin-top: 0;
    }

    .tab-btn:hover {
      color: var(--muted-strong);
      background: rgba(148, 163, 184, 0.08);
      transform: none;
    }

    .tab-btn--active {
      color: var(--text);
      border-bottom-color: #38bdf8;
      font-weight: 600;
    }

    .tab-content {
      display: none;
    }

    .tab-content--active {
      display: block;
    }

    .section-title {
      font-size: 0.95rem;
      margin: 18px 0 8px;
      color: var(--text);
      font-weight: 600;
    }

    label {
      font-size: 0.85rem;
      color: var(--muted-strong);
      display: block;
      margin-bottom: 4px;
    }

    input[type="date"],
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--card-bg);
      color: var(--text);
      font-size: 0.9rem;
    }

    input[type="date"]:focus,
    select:focus {
      outline: none;
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px #38bdf8;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      margin-top: 16px;
      background: linear-gradient(135deg, #38bdf8, #6366f1);
      color: white;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 10px 20px rgba(56, 189, 248, 0.3);
    }

    button:hover {
      filter: brightness(1.07);
      transform: translateY(-0.5px);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.6);
    }

    .primary-btn {
      margin-top: 12px;
    }

    .small {
      font-size: 0.72rem;
      color: var(--muted);
      margin-top: 6px;
    }

    .error {
      color: var(--error-text);
      font-size: 0.8rem;
      margin-top: 6px;
    }

    /* Dashboard */
    .dashboard {
      margin-top: 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 10px 10px 12px;
      background: var(--card-bg);
    }

    .dashboard-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .dashboard-title {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 10px;
      margin-top: 4px;
    }

    .dashboard-card {
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 8px 9px;
      font-size: 0.78rem;
      background: rgba(148, 163, 184, 0.04);
    }

    .dashboard-card-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .dashboard-row {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      margin-top: 2px;
    }

    .dashboard-label {
      color: var(--muted);
    }

    .dashboard-value {
      font-weight: 500;
    }

    .dashboard-count {
      font-size: 0.72rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .notif-btn {
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 4px 10px;
      font-size: 0.75rem;
      background: transparent;
      color: var(--muted-strong);
      box-shadow: none;
      margin-top: 0;
    }

    .notif-btn:hover {
      background: rgba(148, 163, 184, 0.1);
      transform: none;
    }

    /* Calendar */
    .calendar-wrapper {
      margin-top: 18px;
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 10px;
      background: var(--card-bg);
    }

    .calendar-header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
    }

    .calendar-month-label {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .calendar-nav {
      display: flex;
      gap: 6px;
    }

    .calendar-nav-btn {
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 4px 8px;
      font-size: 0.8rem;
      background: transparent;
      color: var(--muted-strong);
      cursor: pointer;
      box-shadow: none;
      margin-top: 0;
    }

    .calendar-nav-btn:hover {
      background: rgba(148, 163, 184, 0.1);
      transform: none;
    }

    table.calendar {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      font-size: 0.78rem;
    }

    .calendar thead th {
      padding: 4px 0;
      text-align: center;
      font-weight: 500;
      color: var(--calendar-muted-text);
    }

    .calendar td {
      border-radius: 8px;
      padding: 4px;
      vertical-align: top;
    }

    .calendar-cell {
      background: var(--calendar-cell-bg);
      border: 1px solid transparent;
      cursor: pointer;
      min-height: 44px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .calendar-cell--today {
      border-color: #38bdf8;
    }

    .calendar-cell--other {
      opacity: var(--calendar-other-month-opacity);
    }

    .calendar-cell--selected {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.6);
    }

    .calendar-day-number {
      font-size: 0.76rem;
      text-align: right;
    }

    .calendar-dots {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 2px;
    }

    .calendar-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
    }

    .dot-weekly-launch { background: #38bdf8; }
    .dot-bi-launch { background: #a855f7; }
    .dot-monthly-launch { background: #f97316; }
    .dot-automation { background: #22c55e; }
    .dot-delivery { background: #eab308; }

    .calendar-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 8px;
      font-size: 0.72rem;
      color: var(--muted);
    }

    .calendar-legend span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .calendar-details {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px dashed var(--border);
    }

    .calendar-details-title {
      font-size: 0.82rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .calendar-details-body {
      font-size: 0.78rem;
      color: var(--muted-strong);
    }

    .calendar-details-body ul {
      padding-left: 18px;
      margin: 4px 0;
    }

    /* Results */
    .results {
      margin-top: 20px;
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 12px 10px;
      background: var(--card-bg);
    }

    .results-title {
      font-size: 0.95rem;
      margin-bottom: 8px;
      font-weight: 600;
    }

    table.results-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }

    .results-table th,
    .results-table td {
      padding: 8px 6px;
      text-align: left;
      border-bottom: 1px solid var(--table-row-border);
    }

    .results-table th {
      font-weight: 600;
      color: var(--muted);
      font-size: 0.78rem;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      border: 1px solid var(--pill-border);
      color: var(--text);
    }

    .status-today {
      border-color: #22c55e;
      background: rgba(34, 197, 94, 0.12);
      color: #bbf7d0;
    }

    .status-upcoming {
      border-color: #38bdf8;
      background: rgba(56, 189, 248, 0.12);
      color: #bae6fd;
    }

    .status-past {
      border-color: #f97316;
      background: rgba(249, 115, 22, 0.12);
      color: #fed7aa;
    }

    /* Wizard */
    .wizard-card {
      margin-top: 8px;
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 10px 10px 12px;
      background: var(--card-bg);
    }

    .wizard-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.3fr);
      gap: 14px;
      margin-top: 4px;
    }

    .wizard-section {
      font-size: 0.82rem;
    }

    .wizard-section-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .wizard-row {
      margin-top: 8px;
    }

    .wizard-helper {
      font-size: 0.72rem;
      color: var(--muted);
      margin-top: 4px;
    }

    .wizard-output-card {
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 8px 9px;
      font-size: 0.78rem;
      background: rgba(148, 163, 184, 0.04);
      margin-bottom: 8px;
    }

    .wizard-output-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .wizard-output-row {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      margin-top: 2px;
    }

    .wizard-output-label {
      color: var(--muted);
    }

    .wizard-output-value {
      font-weight: 500;
      text-align: right;
    }

    .wizard-note-textarea {
      width: 100%;
      min-height: 110px;
      resize: vertical;
      margin-top: 4px;
      font-size: 0.78rem;
      line-height: 1.35;
    }

    .wizard-checklist {
      font-size: 0.78rem;
      margin-top: 6px;
      color: var(--muted-strong);
    }

    .wizard-checklist ul {
      padding-left: 18px;
      margin: 4px 0;
    }

    @media (max-width: 800px) {
      .wizard-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 640px) {
      .card {
        padding: 18px 14px 22px;
      }
      h1 {
        font-size: 1.3rem;
      }
      .calendar-day-number {
        font-size: 0.7rem;
      }
      .theme-select-wrapper {
        min-width: 0;
      }
    }
  </style>
</head>
<body data-theme="dark">
  <div class="container">
    <div class="card">
      <div class="card-header">
        <div>
          <h1>Batch Launch Planner</h1>
          <div class="subtitle">
            Tools for batch scheduling and blister pack workflow: schedule overview,
            calendar, and a new blister pack patient wizard.
          </div>
        </div>
        <div class="theme-select-wrapper">
          <span class="theme-label">Theme</span>
          <select id="themeSelect" class="theme-select">
            <option value="dark">Dark</option>
            <option value="light">Light</option>
            <option value="ocean">Ocean</option>
            <option value="emerald">Emerald</option>
            <option value="sunset">Sunset</option>
          </select>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-btn tab-btn--active" data-tab-target="schedule">Schedule</button>
        <button class="tab-btn" data-tab-target="new-patient">New blister patient</button>
      </div>

      <!-- TAB: Schedule -->
      <div id="tab-schedule" class="tab-content tab-content--active">
        <!-- 1. Today's date + Today button -->
        <div>
          <div class="section-title">1. Pick today‚Äôs date</div>
          <label for="todayInput">Today‚Äôs date</label>
          <div style="display: flex; gap: 8px; align-items: center; max-width: 280px;">
            <input type="date" id="todayInput" style="flex: 1;" />
            <button type="button" id="todayBtn" class="calendar-nav-btn" style="margin-top: 0;">
              Today
            </button>
          </div>
          <div class="small">
            This is usually today, but you can choose a future date if you are pre-planning.
          </div>
        </div>

        <button id="calcBtn" class="primary-btn">
          <span>Calculate next launch dates</span>
          <span>üßÆ</span>
        </button>

        <div id="errorBox" class="error" style="display:none;"></div>

        <!-- 2. Weekly dashboard -->
        <div class="dashboard" id="dashboardBox" style="display:none;">
          <div class="dashboard-title-row">
            <div class="dashboard-title">2. Weekly dashboard ‚Äì launches & automations</div>
            <button type="button" id="enableNotificationsBtn" class="notif-btn">
              üîî Enable notifications
            </button>
          </div>
          <div class="small">
            Shows the next launch and automation dates for each batch based on the selected ‚Äútoday‚Äù.
            Notifications trigger when today is a launch or automation day.
          </div>
          <div class="dashboard-grid" id="dashboardBody">
            <!-- Filled by JS -->
          </div>
        </div>

        <!-- 3. Calendar view -->
        <div class="section-title" style="margin-top: 20px;">3. Calendar view</div>
        <div class="calendar-wrapper">
          <div class="calendar-header-bar">
            <div class="calendar-month-label" id="calendarMonthLabel">Month Year</div>
            <div class="calendar-nav">
              <button type="button" id="prevMonthBtn" class="calendar-nav-btn">‚óÄ</button>
              <button type="button" id="nextMonthBtn" class="calendar-nav-btn">‚ñ∂</button>
            </div>
          </div>
          <table class="calendar">
            <thead>
              <tr>
                <th>Sun</th>
                <th>Mon</th>
                <th>Tue</th>
                <th>Wed</th>
                <th>Thu</th>
                <th>Fri</th>
                <th>Sat</th>
              </tr>
            </thead>
            <tbody id="calendarBody">
              <!-- Filled by JS -->
            </tbody>
          </table>

          <div class="calendar-legend">
            <span><span class="calendar-dot dot-weekly-launch"></span> Weekly launch</span>
            <span><span class="calendar-dot dot-bi-launch"></span> Bi-weekly launch</span>
            <span><span class="calendar-dot dot-monthly-launch"></span> 28-day ‚Äúmonthly‚Äù launch</span>
            <span><span class="calendar-dot dot-automation"></span> Automation day</span>
            <span><span class="calendar-dot dot-delivery"></span> Delivery day</span>
          </div>

          <div class="calendar-details" id="calendarDetails">
            <div class="calendar-details-title">Day details</div>
            <div class="calendar-details-body">
              Select a date in the calendar to see all launches, automations, and deliveries on that day.
            </div>
          </div>
        </div>

        <!-- 4. Results table -->
        <div class="results" id="resultsBox" style="display:none;">
          <div class="results-title">4. Next launch dates</div>
          <table class="results-table">
            <thead>
              <tr>
                <th>Batch</th>
                <th>Next launch date</th>
                <th>Day of week</th>
                <th>Days until launch</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="resultsTableBody">
              <!-- Filled by JS -->
            </tbody>
          </table>
          <div class="small" style="margin-top:8px;">
            Anchor rules:
            Weekly = every Sunday;
            Bi-weekly anchor = Nov 23, 2025;
            28-day ‚Äúmonthly‚Äù anchor = Nov 16, 2025.
            Pattern: Launch (Sunday) ‚Üí Automation (Wednesday, +3 days) ‚Üí Delivery (Monday, +8 days).
          </div>
        </div>
      </div>

      <!-- TAB: New blister patient -->
      <div id="tab-new-patient" class="tab-content">
        <div class="section-title">New blister pack patient wizard</div>
        <div class="small">
          Use this wizard when a brand-new blister patient is added. It helps you plan bridge blister
          (if needed), first CPAK cycle timing, a copy-ready HealthWATCH note, and a MAR setup checklist.
        </div>

        <div class="wizard-card">
          <div class="wizard-grid">
            <!-- Left: inputs -->
            <div class="wizard-section">
              <div class="wizard-section-title">1. Patient & batch details</div>

              <div class="wizard-row">
                <label for="wizardBatchType">Batch type</label>
                <select id="wizardBatchType">
                  <option value="">Select...</option>
                  <option value="tue-weekly">Weekly ‚Äì Tuesday batch</option>
                  <option value="wed-weekly">Weekly ‚Äì Wednesday batch</option>
                  <option value="biweekly">Bi-weekly batch</option>
                  <option value="monthly">28-day ‚Äúmonthly‚Äù batch</option>
                </select>
                <div class="wizard-helper">
                  Choose which SS-CPAK-7 batch the patient will belong to (Tuesday, Wednesday, Bi-weekly, Monthly).
                </div>
              </div>

              <div class="wizard-row" style="margin-top:10px;">
                <label for="wizardStartDate">Patient start date</label>
                <input type="date" id="wizardStartDate" />
                <div class="wizard-helper">
                  This is the date the patient is first set up for blister packs at the pharmacy.
                </div>
              </div>

              <div class="wizard-row" style="margin-top:10px;">
                <label for="wizardHasSupply">Does the patient have enough supply at home?</label>
                <select id="wizardHasSupply">
                  <option value="">Select...</option>
                  <option value="yes">Yes ‚Äì they have enough supply until the next cycle</option>
                  <option value="no">No ‚Äì they have little or no supply at home</option>
                </select>
                <div class="wizard-helper">
                  If ‚ÄúNo‚Äù, the wizard will recommend a non-billed bridge blister until their first CPAK cycle.
                </div>
              </div>

              <button id="wizardGenerateBtn" class="primary-btn">
                <span>Generate plan</span>
                <span>‚ú®</span>
              </button>

              <div id="wizardErrorBox" class="error" style="display:none;"></div>
            </div>

            <!-- Right: output -->
            <div class="wizard-section">
              <div class="wizard-section-title">Plan & documentation</div>

              <div id="wizardOutputBox" style="display:none;">
                <div class="wizard-output-card">
                  <div class="wizard-output-title">Summary</div>
                  <div class="wizard-output-row">
                    <span class="wizard-output-label">Batch</span>
                    <span class="wizard-output-value" id="wizardSummaryBatch">‚Äî</span>
                  </div>
                  <div class="wizard-output-row">
                    <span class="wizard-output-label">Start date</span>
                    <span class="wizard-output-value" id="wizardSummaryStartDate">‚Äî</span>
                  </div>
                  <div class="wizard-output-row">
                    <span class="wizard-output-label">First launch (Sunday)</span>
                    <span class="wizard-output-value" id="wizardSummaryLaunchDate">‚Äî</span>
                  </div>
                  <div class="wizard-output-row">
                    <span class="wizard-output-label">Bridge blister</span>
                    <span class="wizard-output-value" id="wizardSummaryBridge">‚Äî</span>
                  </div>
                  <div class="wizard-output-row">
                    <span class="wizard-output-label">Automation (Wednesday)</span>
                    <span class="wizard-output-value" id="wizardSummaryAutomation">‚Äî</span>
                  </div>
                  <div class="wizard-output-row">
                    <span class="wizard-output-label">CPAK delivery (Monday)</span>
                    <span class="wizard-output-value" id="wizardSummaryDelivery">‚Äî</span>
                  </div>
                  <div class="wizard-output-row">
                    <span class="wizard-output-label">Bagging/pick-up (Sunday)</span>
                    <span class="wizard-output-value" id="wizardSummaryBagging">‚Äî</span>
                  </div>
                </div>

                <div class="wizard-output-card">
                  <div class="wizard-output-title">HealthWATCH note (copy-ready)</div>
                  <textarea id="wizardNoteText" class="wizard-note-textarea" readonly></textarea>
                  <div class="wizard-helper">
                    Copy and paste into the patient‚Äôs profile note in HealthWATCH. Adjust wording as needed.
                  </div>
                </div>

                <div class="wizard-output-card wizard-checklist">
                  <div class="wizard-output-title">MAR & batch setup checklist</div>
                  <ul>
                    <li>Assign Group: <strong>SS-CPAK-7</strong> and select the correct batch (Tuesday, Wednesday, Bi-weekly, or Monthly).</li>
                    <li>Re-log all active prescriptions and print each prescription form; confirm quantities match 7/14/28-day multiples.</li>
                    <li>Update Group/Packaging Info: include in batch = Yes; Packaging type = Shared Services CPAK; assign card number.</li>
                    <li>Assign each medication to the correct slots (AM/Noon/PM/HS) with correct tablet counts or fractions.</li>
                    <li>Print the MAR (including logs), file it in the correct batch binder with a Change Log sheet attached, alphabetically by last name.</li>
                  </ul>
                </div>
              </div>

              <div id="wizardPlaceholder" class="wizard-helper">
                Fill out the batch type, patient start date, and supply at home,
                then click ‚ÄúGenerate plan‚Äù to see bridge blister needs, first CPAK cycle,
                and documentation prompts.
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- END tabs -->
    </div>
  </div>

  <script>
    // ---- CONFIG (anchors & rules) ----

    // Weekly: every Sunday
    const WEEKLY_TARGET_WEEKDAY = 0; // 0 = Sunday

    // Bi-weekly anchor: Nov 23, 2025
    const BIWEEKLY_ANCHOR = new Date(2025, 10, 23); // months 0-based; 10 = Nov
    BIWEEKLY_ANCHOR.setHours(0, 0, 0, 0);

    // Monthly (28-day) anchor: Nov 16, 2025
    const MONTHLY_ANCHOR = new Date(2025, 10, 16);
    MONTHLY_ANCHOR.setHours(0, 0, 0, 0);

    const BIWEEKLY_INTERVAL = 14; // days
    const MONTHLY_INTERVAL = 28;  // days

    // For calendar
    let currentMonthDate = null; // first day of visible month
    let calendarEventsMap = {};  // { "yyyy-mm-dd": [ { type, label } ] }

    const EVENT_TYPES = {
      weeklyLaunch: { label: "Weekly batch launch", dotClass: "dot-weekly-launch" },
      biweeklyLaunch: { label: "Bi-weekly batch launch", dotClass: "dot-bi-launch" },
      monthlyLaunch: { label: "28-day ‚Äúmonthly‚Äù batch launch", dotClass: "dot-monthly-launch" },
      weeklyAutomation: { label: "Weekly batch automation", dotClass: "dot-automation" },
      biweeklyAutomation: { label: "Bi-weekly batch automation", dotClass: "dot-automation" },
      monthlyAutomation: { label: "Monthly batch automation", dotClass: "dot-automation" },
      weeklyDelivery: { label: "Weekly batch delivery", dotClass: "dot-delivery" },
      biweeklyDelivery: { label: "Bi-weekly batch delivery", dotClass: "dot-delivery" },
      monthlyDelivery: { label: "Monthly batch delivery", dotClass: "dot-delivery" }
    };

    // Notifications
    let notificationsEnabled = false;

    // Wizard batch config
    const WIZARD_BATCH_CONFIG = {
      "tue-weekly": {
        label: "Weekly ‚Äì Tuesday batch",
        binder: "Tuesday SS-CPAK-7 binder"
      },
      "wed-weekly": {
        label: "Weekly ‚Äì Wednesday batch",
        binder: "Wednesday SS-CPAK-7 binder"
      },
      "biweekly": {
        label: "Bi-weekly batch",
        binder: "Bi-weekly SS-CPAK-7 binder"
      },
      "monthly": {
        label: "28-day ‚Äúmonthly‚Äù batch",
        binder: "Monthly SS-CPAK-7 binder"
      }
    };

    // ---- DATE UTILITIES ----

    function parseLocalDate(input) {
      if (!input) return null;
      const [year, month, day] = input.split("-").map(Number);
      if (!year || !month || !day) return null;
      const d = new Date(year, month - 1, day);
      d.setHours(0, 0, 0, 0);
      return d;
    }

    function formatDateYMD(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, "0");
      const d = String(date.getDate()).padStart(2, "0");
      return `${y}-${m}-${d}`;
    }

    function formatNiceDate(date) {
      return date.toLocaleDateString(undefined, {
        weekday: "short",
        year: "numeric",
        month: "short",
        day: "numeric"
      });
    }

    function formatNiceDateNoWeekday(date) {
      return date.toLocaleDateString(undefined, {
        year: "numeric",
        month: "short",
        day: "numeric"
      });
    }

    function getDayName(date) {
      return date.toLocaleDateString(undefined, { weekday: "long" });
    }

    function addDays(date, days) {
      const d = new Date(date);
      d.setDate(d.getDate() + days);
      return d;
    }

    function diffInDays(a, b) {
      const msPerDay = 24 * 60 * 60 * 1000;
      return Math.round((b - a) / msPerDay);
    }

    // Next Sunday (weekly) from "today"
    function getNextWeeklyLaunch(today) {
      const todayDow = today.getDay(); // 0 = Sunday
      const diff = (7 + WEEKLY_TARGET_WEEKDAY - todayDow) % 7;
      return addDays(today, diff); // diff = 0 ‚Üí launch today
    }

    // Generic cycle: next date >= today from anchor + n * intervalDays
    function getNextCycleLaunch(today, anchor, intervalDays) {
      let next = new Date(anchor);
      while (next < today) {
        next = addDays(next, intervalDays);
      }
      return next;
    }

    // For wizard: next Sunday on or after given date
    function getNextSundayFrom(date) {
      const dow = date.getDay(); // 0 = Sunday
      const diff = (7 - dow) % 7;
      return addDays(date, diff);
    }

    // ---- THEME ----

    function applyTheme(theme) {
      document.body.setAttribute("data-theme", theme);
      localStorage.setItem("batchTheme", theme);
      const select = document.getElementById("themeSelect");
      if (select && select.value !== theme) {
        select.value = theme;
      }
    }

    function initTheme() {
      const saved = localStorage.getItem("batchTheme");
      const defaultTheme = saved || "dark";
      applyTheme(defaultTheme);
      const select = document.getElementById("themeSelect");
      if (select) {
        select.value = defaultTheme;
        select.addEventListener("change", (e) => {
          applyTheme(e.target.value);
        });
      }
    }

    // ---- TABS ----

    function initTabs() {
      const tabButtons = document.querySelectorAll(".tab-btn");
      const tabContents = {
        "schedule": document.getElementById("tab-schedule"),
        "new-patient": document.getElementById("tab-new-patient")
      };

      tabButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const target = btn.getAttribute("data-tab-target");
          if (!target) return;

          tabButtons.forEach(b => b.classList.remove("tab-btn--active"));
          btn.classList.add("tab-btn--active");

          Object.keys(tabContents).forEach(key => {
            if (tabContents[key]) {
              tabContents[key].classList.toggle(
                "tab-content--active",
                key === target
              );
            }
          });
        });
      });
    }

    // ---- TODAY INPUT & BUTTON ----

    function setDefaultToday() {
      const todayInput = document.getElementById("todayInput");
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      todayInput.value = formatDateYMD(today);
    }

    function initTodayButton() {
      const todayBtn = document.getElementById("todayBtn");
      const todayInput = document.getElementById("todayInput");
      const calcBtn = document.getElementById("calcBtn");
      if (todayBtn && todayInput && calcBtn) {
        todayBtn.addEventListener("click", function () {
          const today = new Date();
          today.setHours(0, 0, 0, 0);
          todayInput.value = formatDateYMD(today);
          calcBtn.click();
        });
      }
    }

    // ---- NOTIFICATIONS ----

    function initNotifications() {
      const btn = document.getElementById("enableNotificationsBtn");
      if (!btn) return;

      if (!("Notification" in window)) {
        btn.style.display = "none";
        return;
      }

      function updateButton() {
        if (!notificationsEnabled || Notification.permission !== "granted") {
          btn.textContent = "üîî Enable notifications";
        } else {
          btn.textContent = "üîî Notifications on";
        }
      }

      btn.addEventListener("click", async () => {
        if (Notification.permission === "granted") {
          notificationsEnabled = !notificationsEnabled;
          updateButton();
          return;
        }

        try {
          const permission = await Notification.requestPermission();
          if (permission === "granted") {
            notificationsEnabled = true;
          } else {
            notificationsEnabled = false;
          }
        } catch (e) {
          notificationsEnabled = false;
        }
        updateButton();
      });

      updateButton();
    }

    function handleNotifications(batches, today) {
      if (!notificationsEnabled) return;
      if (!("Notification" in window)) return;
      if (Notification.permission !== "granted") return;

      batches.forEach(batch => {
        if (batch.daysUntilLaunch === 0) {
          new Notification(`Launch ${batch.name} today`);
        }
        if (batch.daysUntilAutomation === 0) {
          new Notification(`Send automation for ${batch.name} today`);
        }
      });
    }

    // ---- CALENDAR EVENTS ----

    function addEventToMap(dateKey, type) {
      if (!EVENT_TYPES[type]) return;
      if (!calendarEventsMap[dateKey]) {
        calendarEventsMap[dateKey] = [];
      }
      calendarEventsMap[dateKey].push({
        type,
        label: EVENT_TYPES[type].label,
        dotClass: EVENT_TYPES[type].dotClass
      });
    }

    function buildCalendarEvents(start, end) {
      calendarEventsMap = {};
      const searchStart = addDays(start, -14);
      const searchEnd = addDays(end, 14);

      // Weekly events
      let d = new Date(searchStart);
      d.setHours(0, 0, 0, 0);
      while (d.getDay() !== WEEKLY_TARGET_WEEKDAY) {
        d = addDays(d, 1);
      }
      while (d <= searchEnd) {
        const launch = new Date(d);
        const automation = addDays(launch, 3); // Wed
        const delivery = addDays(launch, 8);   // Mon

        const launchKey = formatDateYMD(launch);
        const autoKey = formatDateYMD(automation);
        const delKey = formatDateYMD(delivery);

        if (launch >= start && launch <= end) addEventToMap(launchKey, "weeklyLaunch");
        if (automation >= start && automation <= end) addEventToMap(autoKey, "weeklyAutomation");
        if (delivery >= start && delivery <= end) addEventToMap(delKey, "weeklyDelivery");

        d = addDays(d, 7);
      }

      // Bi-weekly events
      let bi = new Date(BIWEEKLY_ANCHOR);
      bi.setHours(0, 0, 0, 0);
      while (bi <= searchEnd) {
        const launch = new Date(bi);
        const automation = addDays(launch, 3);
        const delivery = addDays(launch, 8);

        const launchKey = formatDateYMD(launch);
        const autoKey = formatDateYMD(automation);
        const delKey = formatDateYMD(delivery);

        if (launch >= start && launch <= end) addEventToMap(launchKey, "biweeklyLaunch");
        if (automation >= start && automation <= end) addEventToMap(autoKey, "biweeklyAutomation");
        if (delivery >= start && delivery <= end) addEventToMap(delKey, "biweeklyDelivery");

        bi = addDays(bi, BIWEEKLY_INTERVAL);
      }

      // Monthly (28-day) events
      let mo = new Date(MONTHLY_ANCHOR);
      mo.setHours(0, 0, 0, 0);
      while (mo <= searchEnd) {
        const launch = new Date(mo);
        const automation = addDays(launch, 3);
        const delivery = addDays(launch, 8);

        const launchKey = formatDateYMD(launch);
        const autoKey = formatDateYMD(automation);
        const delKey = formatDateYMD(delivery);

        if (launch >= start && launch <= end) addEventToMap(launchKey, "monthlyLaunch");
        if (automation >= start && automation <= end) addEventToMap(autoKey, "monthlyAutomation");
        if (delivery >= start && delivery <= end) addEventToMap(delKey, "monthlyDelivery");

        mo = addDays(mo, MONTHLY_INTERVAL);
      }
    }

    function renderCalendar() {
      const monthLabelEl = document.getElementById("calendarMonthLabel");
      const tbody = document.getElementById("calendarBody");
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      const year = currentMonthDate.getFullYear();
      const month = currentMonthDate.getMonth();

      monthLabelEl.textContent = currentMonthDate.toLocaleDateString(undefined, {
        month: "long",
        year: "numeric"
      });

      const firstOfMonth = new Date(year, month, 1);
      const lastOfMonth = new Date(year, month + 1, 0);
      firstOfMonth.setHours(0, 0, 0, 0);
      lastOfMonth.setHours(0, 0, 0, 0);

      const gridStart = new Date(firstOfMonth);
      while (gridStart.getDay() !== 0) {
        gridStart.setDate(gridStart.getDate() - 1);
      }

      const gridEnd = new Date(gridStart);
      gridEnd.setDate(gridEnd.getDate() + 6 * 7 - 1);
      gridEnd.setHours(0, 0, 0, 0);

      buildCalendarEvents(gridStart, gridEnd);

      tbody.innerHTML = "";
      let current = new Date(gridStart);

      const todayKey = formatDateYMD(today);
      let defaultSelectedKey = todayKey;

      if (today < firstOfMonth || today > lastOfMonth) {
        defaultSelectedKey = formatDateYMD(firstOfMonth);
      }

      for (let week = 0; week < 6; week++) {
        const tr = document.createElement("tr");
        for (let dow = 0; dow < 7; dow++) {
          const td = document.createElement("td");
          const cellDate = new Date(current);
          const cellKey = formatDateYMD(cellDate);
          const cellMonth = cellDate.getMonth();

          const cellDiv = document.createElement("div");
          cellDiv.classList.add("calendar-cell");
          if (cellMonth !== month) {
            cellDiv.classList.add("calendar-cell--other");
          }
          if (cellKey === todayKey) {
            cellDiv.classList.add("calendar-cell--today");
          }
          cellDiv.dataset.dateKey = cellKey;

          const dayNumber = document.createElement("div");
          dayNumber.classList.add("calendar-day-number");
          dayNumber.textContent = cellDate.getDate();

          const dotsDiv = document.createElement("div");
          dotsDiv.classList.add("calendar-dots");

          const events = calendarEventsMap[cellKey] || [];
          const usedTypes = new Set();
          events.forEach(ev => {
            if (usedTypes.has(ev.type)) return;
            usedTypes.add(ev.type);
            const dot = document.createElement("span");
            dot.classList.add("calendar-dot");
            if (ev.dotClass) dot.classList.add(ev.dotClass);
            dotsDiv.appendChild(dot);
          });

          cellDiv.appendChild(dayNumber);
          cellDiv.appendChild(dotsDiv);

          cellDiv.addEventListener("click", () => {
            selectCalendarDate(cellKey);
          });

          td.appendChild(cellDiv);
          tr.appendChild(td);

          current.setDate(current.getDate() + 1);
        }
        tbody.appendChild(tr);
      }

      selectCalendarDate(defaultSelectedKey);
    }

    function selectCalendarDate(dateKey) {
      const tbody = document.getElementById("calendarBody");
      if (!tbody) return;

      const prevSelected = tbody.querySelector(".calendar-cell--selected");
      if (prevSelected) {
        prevSelected.classList.remove("calendar-cell--selected");
      }

      const cell = tbody.querySelector('[data-date-key="' + dateKey + '"]');
      if (cell) {
        cell.classList.add("calendar-cell--selected");
      }

      const detailsEl = document.getElementById("calendarDetails");
      const titleEl = detailsEl.querySelector(".calendar-details-title");
      const bodyEl = detailsEl.querySelector(".calendar-details-body");

      const [year, month, day] = dateKey.split("-").map(Number);
      const dateObj = new Date(year, month - 1, day);
      const niceDate = dateObj.toLocaleDateString(undefined, {
        weekday: "long",
        year: "numeric",
        month: "short",
        day: "numeric"
      });

      titleEl.textContent = "Events on " + niceDate;

      const events = calendarEventsMap[dateKey] || [];
      if (!events.length) {
        bodyEl.textContent = "No launches, automations, or deliveries on this day.";
        return;
      }

      let html = "<ul>";
      events.forEach(ev => {
        html += "<li>" + ev.label + "</li>";
      });
      html += "</ul>";
      bodyEl.innerHTML = html;
    }

    function initCalendar() {
      const now = new Date();
      now.setHours(0, 0, 0, 0);
      currentMonthDate = new Date(now.getFullYear(), now.getMonth(), 1);
      const prevBtn = document.getElementById("prevMonthBtn");
      const nextBtn = document.getElementById("nextMonthBtn");

      prevBtn.addEventListener("click", () => {
        currentMonthDate = new Date(
          currentMonthDate.getFullYear(),
          currentMonthDate.getMonth() - 1,
          1
        );
        renderCalendar();
      });

      nextBtn.addEventListener("click", () => {
        currentMonthDate = new Date(
          currentMonthDate.getFullYear(),
          currentMonthDate.getMonth() + 1,
          1
        );
        renderCalendar();
      });

      renderCalendar();
    }

    // ---- DASHBOARD RENDER ----

    function renderDashboard(batches) {
      const box = document.getElementById("dashboardBox");
      const body = document.getElementById("dashboardBody");
      body.innerHTML = "";

      batches.forEach(batch => {
        const card = document.createElement("div");
        card.classList.add("dashboard-card");

        const title = document.createElement("div");
        title.classList.add("dashboard-card-title");
        title.textContent = batch.name;
        card.appendChild(title);

        const launchRow = document.createElement("div");
        launchRow.classList.add("dashboard-row");
        launchRow.innerHTML = `
          <span class="dashboard-label">Next launch</span>
          <span class="dashboard-value">${formatNiceDate(batch.nextLaunch)}</span>
        `;
        card.appendChild(launchRow);

        const autoRow = document.createElement("div");
        autoRow.classList.add("dashboard-row");
        autoRow.innerHTML = `
          <span class="dashboard-label">Automation</span>
          <span class="dashboard-value">${formatNiceDate(batch.automationDate)}</span>
        `;
        card.appendChild(autoRow);

        const counts = document.createElement("div");
        counts.classList.add("dashboard-count");
        const launchText = batch.daysUntilLaunch === 0
          ? "Launch today"
          : batch.daysUntilLaunch === 1
          ? "Launch in 1 day"
          : `Launch in ${batch.daysUntilLaunch} days`;
        const autoText = batch.daysUntilAutomation === 0
          ? "Automation today"
          : batch.daysUntilAutomation === 1
          ? "Automation in 1 day"
          : `Automation in ${batch.daysUntilAutomation} days`;
        counts.textContent = `${launchText} ¬∑ ${autoText}`;
        card.appendChild(counts);

        body.appendChild(card);
      });

      box.style.display = "block";
    }

    // ---- WIZARD ----

    function initWizard() {
      const btn = document.getElementById("wizardGenerateBtn");
      if (!btn) return;

      btn.addEventListener("click", () => {
        const batchValue = document.getElementById("wizardBatchType").value;
        const startStr = document.getElementById("wizardStartDate").value;
        const hasSupplyValue = document.getElementById("wizardHasSupply").value;
        const errorBox = document.getElementById("wizardErrorBox");
        const outputBox = document.getElementById("wizardOutputBox");
        const placeholder = document.getElementById("wizardPlaceholder");

        errorBox.style.display = "none";
        errorBox.textContent = "";

        if (!batchValue || !startStr || !hasSupplyValue) {
          errorBox.textContent = "Please fill out batch type, patient start date, and supply at home.";
          errorBox.style.display = "block";
          outputBox.style.display = "none";
          placeholder.style.display = "block";
          return;
        }

        const batchConfig = WIZARD_BATCH_CONFIG[batchValue];
        if (!batchConfig) {
          errorBox.textContent = "Invalid batch type selected.";
          errorBox.style.display = "block";
          outputBox.style.display = "none";
          placeholder.style.display = "block";
          return;
        }

        const startDate = parseLocalDate(startStr);
        if (!startDate) {
          errorBox.textContent = "Please enter a valid start date.";
          errorBox.style.display = "block";
          outputBox.style.display = "none";
          placeholder.style.display = "block";
          return;
        }

        const nextLaunch = getNextSundayFrom(startDate);
        const automation = addDays(nextLaunch, 3);
        const delivery = addDays(nextLaunch, 8);
        const bagging = addDays(nextLaunch, 14);

        const hasSupply = hasSupplyValue === "yes";

        let bridgeText = "No bridge required";
        let bridgeDetail = "";
        if (!hasSupply) {
          const bridgeEnd = addDays(nextLaunch, -1);
          const daysCover = diffInDays(startDate, nextLaunch);
          bridgeText = `Yes ‚Äì cover from ${formatNiceDateNoWeekday(startDate)} to ${formatNiceDateNoWeekday(bridgeEnd)} (${daysCover} days)`;
          bridgeDetail = `Bridge blister (non-billed) dispensed to cover from ${formatNiceDateNoWeekday(startDate)} up to (but not including) the first CPAK blister on ${formatNiceDateNoWeekday(nextLaunch)}.`;
        }

        // Fill summary
        document.getElementById("wizardSummaryBatch").textContent = batchConfig.label;
        document.getElementById("wizardSummaryStartDate").textContent = formatNiceDateNoWeekday(startDate);
        document.getElementById("wizardSummaryLaunchDate").textContent = formatNiceDate(nextLaunch);
        document.getElementById("wizardSummaryBridge").textContent = bridgeText;
        document.getElementById("wizardSummaryAutomation").textContent = formatNiceDate(automation);
        document.getElementById("wizardSummaryDelivery").textContent = formatNiceDate(delivery);
        document.getElementById("wizardSummaryBagging").textContent = formatNiceDate(bagging);

        // HealthWATCH note
        let noteLines = [];

        if (!hasSupply) {
          noteLines.push(bridgeDetail);
        } else {
          noteLines.push(`Patient has existing supply at home and will transition to CPAK blister cycle starting on ${formatNiceDateNoWeekday(nextLaunch)}.`);
        }

        noteLines.push(`Added to Group SS-CPAK-7, ${batchConfig.label}.`);
        noteLines.push(`First CPAK cycle:`);
        noteLines.push(`- Launch/billing: ${formatNiceDate(nextLaunch)} (Sunday).`);
        noteLines.push(`- Automation: ${formatNiceDate(automation)} (Wednesday, after queues cleared).`);
        noteLines.push(`- CPAK delivery: ${formatNiceDate(delivery)} (Monday).`);
        noteLines.push(`- Bagging/pick-up: ${formatNiceDate(bagging)} (Sunday, after product check).`);

        const noteText = noteLines.join("\n");
        document.getElementById("wizardNoteText").value = noteText;

        placeholder.style.display = "none";
        outputBox.style.display = "block";
      });
    }

    // ---- MAIN RESULTS HANDLER (Schedule tab) ----

    document.getElementById("calcBtn").addEventListener("click", function () {
      const errorBox = document.getElementById("errorBox");
      const resultsBox = document.getElementById("resultsBox");
      const tbody = document.getElementById("resultsTableBody");

      errorBox.style.display = "none";
      errorBox.textContent = "";
      resultsBox.style.display = "none";
      tbody.innerHTML = "";

      const todayStr = document.getElementById("todayInput").value;
      const today = parseLocalDate(todayStr);

      if (!today) {
        errorBox.textContent = "Please enter a valid value for today‚Äôs date.";
        errorBox.style.display = "block";
        return;
      }

      const batches = [];

      // Weekly
      const weeklyNext = getNextWeeklyLaunch(today);
      batches.push({
        name: "Weekly batch",
        nextLaunch: weeklyNext
      });

      // Bi-weekly
      const biNext = getNextCycleLaunch(today, BIWEEKLY_ANCHOR, BIWEEKLY_INTERVAL);
      batches.push({
        name: "Bi-weekly batch",
        nextLaunch: biNext
      });

      // Monthly (28-day)
      const monthlyNext = getNextCycleLaunch(today, MONTHLY_ANCHOR, MONTHLY_INTERVAL);
      batches.push({
        name: "28-day ‚Äúmonthly‚Äù batch",
        nextLaunch: monthlyNext
      });

      // Enrich with automation + countdowns
      batches.forEach(batch => {
        const automation = addDays(batch.nextLaunch, 3);
        batch.automationDate = automation;
        batch.daysUntilLaunch = diffInDays(today, batch.nextLaunch);
        batch.daysUntilAutomation = diffInDays(today, automation);
      });

      // Fill results table
      batches.forEach(batch => {
        let statusClass = "status-upcoming";
        let statusText = "Upcoming";

        if (batch.daysUntilLaunch === 0) {
          statusClass = "status-today";
          statusText = "Launch today";
        } else if (batch.daysUntilLaunch < 0) {
          statusClass = "status-past";
          statusText = "Already passed";
        }

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${batch.name}</td>
          <td>${formatNiceDate(batch.nextLaunch)}</td>
          <td>${getDayName(batch.nextLaunch)}</td>
          <td>${batch.daysUntilLaunch}</td>
          <td>
            <span class="status-pill ${statusClass}">
              ${statusText}
            </span>
          </td>
        `;
        tbody.appendChild(tr);
      });

      resultsBox.style.display = "block";

      // Update dashboard
      renderDashboard(batches);

      // Fire notifications (if enabled)
      handleNotifications(batches, today);
    });

    // ---- INIT ----

    setDefaultToday();
    initTodayButton();
    initTheme();
    initTabs();
    initNotifications();
    initCalendar();
    initWizard();
  </script>
</body>
</html>
