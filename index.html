<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Batch Launch Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --text: #e5e7eb;
      --card-bg: #020617;
      --border: #1f2937;
      --muted: #9ca3af;
      --muted-strong: #d1d5db;
      --pill-border: #4b5563;
      --error-text: #fecaca;
      --table-row-border: #111827;
      --calendar-cell-bg: #020617;
      --calendar-muted-text: #9ca3af;
      --calendar-other-month-opacity: 0.35;
    }

    body[data-theme="light"] {
      --bg: #f3f4f6;
      --text: #111827;
      --card-bg: #ffffff;
      --border: #e5e7eb;
      --muted: #6b7280;
      --muted-strong: #4b5563;
      --pill-border: #9ca3af;
      --error-text: #b91c1c;
      --table-row-border: #e5e7eb;
      --calendar-cell-bg: #ffffff;
      --calendar-muted-text: #9ca3af;
      --calendar-other-month-opacity: 0.35;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      max-width: 1000px;
      width: 100%;
      padding: 24px 16px 40px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 24px 20px 28px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.6);
      border: 1px solid var(--border);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    h1 {
      font-size: 1.6rem;
      margin: 0 0 4px;
      color: var(--text);
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--muted);
    }

    .theme-toggle-btn {
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 6px 12px;
      font-size: 0.8rem;
      cursor: pointer;
      background: transparent;
      color: var(--muted-strong);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .theme-toggle-btn:hover {
      background: rgba(148, 163, 184, 0.1);
    }

    .section-title {
      font-size: 0.95rem;
      margin: 18px 0 8px;
      color: var(--text);
      font-weight: 600;
    }

    label {
      font-size: 0.85rem;
      color: var(--muted-strong);
      display: block;
      margin-bottom: 4px;
    }

    input[type="date"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--card-bg);
      color: var(--text);
      font-size: 0.9rem;
    }

    input[type="date"]:focus {
      outline: none;
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px #38bdf8;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      margin-top: 16px;
      background: linear-gradient(135deg, #38bdf8, #6366f1);
      color: white;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 10px 20px rgba(56, 189, 248, 0.3);
    }

    button:hover {
      filter: brightness(1.07);
      transform: translateY(-0.5px);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.6);
    }

    .primary-btn {
      margin-top: 12px;
    }

    .small {
      font-size: 0.72rem;
      color: var(--muted);
      margin-top: 6px;
    }

    .error {
      color: var(--error-text);
      font-size: 0.8rem;
      margin-top: 6px;
    }

    /* Calendar */
    .calendar-wrapper {
      margin-top: 18px;
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 10px;
      background: var(--card-bg);
    }

    .calendar-header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
    }

    .calendar-month-label {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .calendar-nav {
      display: flex;
      gap: 6px;
    }

    .calendar-nav-btn {
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 4px 8px;
      font-size: 0.8rem;
      background: transparent;
      color: var(--muted-strong);
      cursor: pointer;
      box-shadow: none;
      margin-top: 0;
    }

    .calendar-nav-btn:hover {
      background: rgba(148, 163, 184, 0.1);
      transform: none;
    }

    table.calendar {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      font-size: 0.78rem;
    }

    .calendar thead th {
      padding: 4px 0;
      text-align: center;
      font-weight: 500;
      color: var(--calendar-muted-text);
    }

    .calendar td {
      border-radius: 8px;
      padding: 4px;
      vertical-align: top;
    }

    .calendar-cell {
      background: var(--calendar-cell-bg);
      border: 1px solid transparent;
      cursor: pointer;
      min-height: 44px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .calendar-cell--today {
      border-color: #38bdf8;
    }

    .calendar-cell--other {
      opacity: var(--calendar-other-month-opacity);
    }

    .calendar-cell--selected {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.6);
    }

    .calendar-day-number {
      font-size: 0.76rem;
      text-align: right;
    }

    .calendar-dots {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 2px;
    }

    .calendar-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
    }

    .dot-weekly-launch { background: #38bdf8; }
    .dot-bi-launch { background: #a855f7; }
    .dot-monthly-launch { background: #f97316; }
    .dot-automation { background: #22c55e; }
    .dot-delivery { background: #eab308; }

    .calendar-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 8px;
      font-size: 0.72rem;
      color: var(--muted);
    }

    .calendar-legend span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .calendar-details {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px dashed var(--border);
    }

    .calendar-details-title {
      font-size: 0.82rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .calendar-details-body {
      font-size: 0.78rem;
      color: var(--muted-strong);
    }

    .calendar-details-body ul {
      padding-left: 18px;
      margin: 4px 0;
    }

    /* Results */
    .results {
      margin-top: 20px;
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 12px 10px;
      background: var(--card-bg);
    }

    .results-title {
      font-size: 0.95rem;
      margin-bottom: 8px;
      font-weight: 600;
    }

    table.results-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }

    .results-table th,
    .results-table td {
      padding: 8px 6px;
      text-align: left;
      border-bottom: 1px solid var(--table-row-border);
    }

    .results-table th {
      font-weight: 600;
      color: var(--muted);
      font-size: 0.78rem;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      border: 1px solid var(--pill-border);
      color: var(--text);
    }

    .status-today {
      border-color: #22c55e;
      background: rgba(34, 197, 94, 0.12);
      color: #bbf7d0;
    }

    .status-upcoming {
      border-color: #38bdf8;
      background: rgba(56, 189, 248, 0.12);
      color: #bae6fd;
    }

    .status-past {
      border-color: #f97316;
      background: rgba(249, 115, 22, 0.12);
      color: #fed7aa;
    }

    @media (max-width: 640px) {
      .card {
        padding: 18px 14px 22px;
      }
      h1 {
        font-size: 1.3rem;
      }
      .calendar-day-number {
        font-size: 0.7rem;
      }
    }
  </style>
</head>
<body data-theme="dark">
  <div class="container">
    <div class="card">
      <div class="card-header">
        <div>
          <h1>Batch Launch Planner</h1>
          <div class="subtitle">
            Enter a date to see upcoming weekly, bi-weekly, and 28-day ‚Äúmonthly‚Äù launches,
            plus a calendar of launches, automations, and deliveries.
          </div>
        </div>
        <button type="button" id="themeToggleBtn" class="theme-toggle-btn">üåô Dark</button>
      </div>

      <!-- 1. Today's date + Today button -->
      <div>
        <div class="section-title">1. Pick today‚Äôs date</div>
        <label for="todayInput">Today‚Äôs date</label>
        <div style="display: flex; gap: 8px; align-items: center; max-width: 280px;">
          <input type="date" id="todayInput" style="flex: 1;" />
          <button type="button" id="todayBtn" class="calendar-nav-btn" style="margin-top: 0;">
            Today
          </button>
        </div>
        <div class="small">
          This is usually today, but you can choose a future date if you are pre-planning.
        </div>
      </div>

      <button id="calcBtn" class="primary-btn">
        <span>Calculate next launch dates</span>
        <span>üßÆ</span>
      </button>

      <div id="errorBox" class="error" style="display:none;"></div>

      <!-- 2. Calendar view -->
      <div class="section-title" style="margin-top: 20px;">2. Calendar view</div>
      <div class="calendar-wrapper">
        <div class="calendar-header-bar">
          <div class="calendar-month-label" id="calendarMonthLabel">Month Year</div>
          <div class="calendar-nav">
            <button type="button" id="prevMonthBtn" class="calendar-nav-btn">‚óÄ</button>
            <button type="button" id="nextMonthBtn" class="calendar-nav-btn">‚ñ∂</button>
          </div>
        </div>
        <table class="calendar">
          <thead>
            <tr>
              <th>Sun</th>
              <th>Mon</th>
              <th>Tue</th>
              <th>Wed</th>
              <th>Thu</th>
              <th>Fri</th>
              <th>Sat</th>
            </tr>
          </thead>
          <tbody id="calendarBody">
            <!-- Filled by JS -->
          </tbody>
        </table>

        <div class="calendar-legend">
          <span><span class="calendar-dot dot-weekly-launch"></span> Weekly launch</span>
          <span><span class="calendar-dot dot-bi-launch"></span> Bi-weekly launch</span>
          <span><span class="calendar-dot dot-monthly-launch"></span> 28-day ‚Äúmonthly‚Äù launch</span>
          <span><span class="calendar-dot dot-automation"></span> Automation day</span>
          <span><span class="calendar-dot dot-delivery"></span> Delivery day</span>
        </div>

        <div class="calendar-details" id="calendarDetails">
          <div class="calendar-details-title">Day details</div>
          <div class="calendar-details-body">
            Select a date in the calendar to see all launches, automations, and deliveries on that day.
          </div>
        </div>
      </div>

      <!-- 3. Results table -->
      <div class="results" id="resultsBox" style="display:none;">
        <div class="results-title">3. Next launch dates</div>
        <table class="results-table">
          <thead>
            <tr>
              <th>Batch</th>
              <th>Next launch date</th>
              <th>Day of week</th>
              <th>Days until launch</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="resultsTableBody">
            <!-- Filled by JS -->
          </tbody>
        </table>
        <div class="small" style="margin-top:8px;">
          Anchor rules:
          Weekly = every Sunday;
          Bi-weekly anchor = Nov 23, 2025;
          28-day ‚Äúmonthly‚Äù anchor = Nov 16, 2025.
          Pattern: Launch (Sunday) ‚Üí Automation (Wednesday, +3 days) ‚Üí Delivery (Monday, +8 days).
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---- CONFIG (anchors & rules) ----

    // Weekly: every Sunday
    const WEEKLY_TARGET_WEEKDAY = 0; // 0 = Sunday

    // Bi-weekly anchor: Nov 23, 2025
    const BIWEEKLY_ANCHOR = new Date(2025, 10, 23); // months 0-based; 10 = Nov
    BIWEEKLY_ANCHOR.setHours(0, 0, 0, 0);

    // Monthly (28-day) anchor: Nov 16, 2025
    const MONTHLY_ANCHOR = new Date(2025, 10, 16);
    MONTHLY_ANCHOR.setHours(0, 0, 0, 0);

    const BIWEEKLY_INTERVAL = 14; // days
    const MONTHLY_INTERVAL = 28;  // days

    // For calendar
    let currentMonthDate = null; // first day of visible month
    let calendarEventsMap = {};  // { "yyyy-mm-dd": [ { type, label } ] }

    const EVENT_TYPES = {
      weeklyLaunch: { label: "Weekly batch launch", dotClass: "dot-weekly-launch" },
      biweeklyLaunch: { label: "Bi-weekly batch launch", dotClass: "dot-bi-launch" },
      monthlyLaunch: { label: "28-day ‚Äúmonthly‚Äù batch launch", dotClass: "dot-monthly-launch" },
      weeklyAutomation: { label: "Weekly batch automation", dotClass: "dot-automation" },
      biweeklyAutomation: { label: "Bi-weekly batch automation", dotClass: "dot-automation" },
      monthlyAutomation: { label: "Monthly batch automation", dotClass: "dot-automation" },
      weeklyDelivery: { label: "Weekly batch delivery", dotClass: "dot-delivery" },
      biweeklyDelivery: { label: "Bi-weekly batch delivery", dotClass: "dot-delivery" },
      monthlyDelivery: { label: "Monthly batch delivery", dotClass: "dot-delivery" }
    };

    // ---- DATE UTILITIES ----

    function parseLocalDate(input) {
      if (!input) return null;
      const [year, month, day] = input.split("-").map(Number);
      if (!year || !month || !day) return null;
      const d = new Date(year, month - 1, day);
      d.setHours(0, 0, 0, 0);
      return d;
    }

    function formatDateYMD(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, "0");
      const d = String(date.getDate()).padStart(2, "0");
      return `${y}-${m}-${d}`;
    }

    function formatNiceDate(date) {
      return date.toLocaleDateString(undefined, {
        weekday: "short",
        year: "numeric",
        month: "short",
        day: "numeric"
      });
    }

    function getDayName(date) {
      return date.toLocaleDateString(undefined, { weekday: "long" });
    }

    function addDays(date, days) {
      const d = new Date(date);
      d.setDate(d.getDate() + days);
      return d;
    }

    function diffInDays(a, b) {
      const msPerDay = 24 * 60 * 60 * 1000;
      return Math.round((b - a) / msPerDay);
    }

    // Next Sunday (weekly) from "today"
    function getNextWeeklyLaunch(today) {
      const todayDow = today.getDay(); // 0 = Sunday
      const diff = (7 + WEEKLY_TARGET_WEEKDAY - todayDow) % 7;
      return addDays(today, diff); // diff = 0 ‚Üí launch today
    }

    // Generic cycle: next date >= today from anchor + n * intervalDays
    function getNextCycleLaunch(today, anchor, intervalDays) {
      let next = new Date(anchor);
      while (next < today) {
        next = addDays(next, intervalDays);
      }
      return next;
    }

    // ---- THEME ----

    function applyTheme(theme) {
      document.body.setAttribute("data-theme", theme);
      localStorage.setItem("batchTheme", theme);
      const btn = document.getElementById("themeToggleBtn");
      if (btn) {
        btn.textContent = theme === "dark" ? "üåô Dark" : "‚òÄÔ∏è Light";
      }
    }

    function initTheme() {
      const saved = localStorage.getItem("batchTheme");
      const defaultTheme = saved || "dark";
      applyTheme(defaultTheme);
      const btn = document.getElementById("themeToggleBtn");
      if (btn) {
        btn.addEventListener("click", () => {
          const current = document.body.getAttribute("data-theme") || "dark";
          const next = current === "dark" ? "light" : "dark";
          applyTheme(next);
        });
      }
    }

    // ---- TODAY INPUT & BUTTON ----

    function setDefaultToday() {
      const todayInput = document.getElementById("todayInput");
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      todayInput.value = formatDateYMD(today);
    }

    function initTodayButton() {
      const todayBtn = document.getElementById("todayBtn");
      const todayInput = document.getElementById("todayInput");
      const calcBtn = document.getElementById("calcBtn");
      if (todayBtn && todayInput && calcBtn) {
        todayBtn.addEventListener("click", function () {
          const today = new Date();
          today.setHours(0, 0, 0, 0);
          todayInput.value = formatDateYMD(today);
          calcBtn.click();
        });
      }
    }

    // ---- CALENDAR EVENTS ----

    function addEventToMap(dateKey, type) {
      if (!EVENT_TYPES[type]) return;
      if (!calendarEventsMap[dateKey]) {
        calendarEventsMap[dateKey] = [];
      }
      calendarEventsMap[dateKey].push({
        type,
        label: EVENT_TYPES[type].label,
        dotClass: EVENT_TYPES[type].dotClass
      });
    }

    function buildCalendarEvents(start, end) {
      calendarEventsMap = {};
      const searchStart = addDays(start, -14);
      const searchEnd = addDays(end, 14);

      // Weekly events (no specific anchor; all Sundays)
      let d = new Date(searchStart);
      d.setHours(0, 0, 0, 0);
      while (d.getDay() !== WEEKLY_TARGET_WEEKDAY) {
        d = addDays(d, 1);
      }
      while (d <= searchEnd) {
        const launch = new Date(d);
        const automation = addDays(launch, 3); // Wed
        const delivery = addDays(launch, 8);   // Mon

        const launchKey = formatDateYMD(launch);
        const autoKey = formatDateYMD(automation);
        const delKey = formatDateYMD(delivery);

        if (launch >= start && launch <= end) addEventToMap(launchKey, "weeklyLaunch");
        if (automation >= start && automation <= end) addEventToMap(autoKey, "weeklyAutomation");
        if (delivery >= start && delivery <= end) addEventToMap(delKey, "weeklyDelivery");

        d = addDays(d, 7);
      }

      // Bi-weekly events
      let bi = new Date(BIWEEKLY_ANCHOR);
      bi.setHours(0, 0, 0, 0);
      while (bi <= searchEnd) {
        const launch = new Date(bi);
        const automation = addDays(launch, 3);
        const delivery = addDays(launch, 8);

        const launchKey = formatDateYMD(launch);
        const autoKey = formatDateYMD(automation);
        const delKey = formatDateYMD(delivery);

        if (launch >= start && launch <= end) addEventToMap(launchKey, "biweeklyLaunch");
        if (automation >= start && automation <= end) addEventToMap(autoKey, "biweeklyAutomation");
        if (delivery >= start && delivery <= end) addEventToMap(delKey, "biweeklyDelivery");

        bi = addDays(bi, BIWEEKLY_INTERVAL);
      }

      // Monthly (28-day) events
      let mo = new Date(MONTHLY_ANCHOR);
      mo.setHours(0, 0, 0, 0);
      while (mo <= searchEnd) {
        const launch = new Date(mo);
        const automation = addDays(launch, 3);
        const delivery = addDays(launch, 8);

        const launchKey = formatDateYMD(launch);
        const autoKey = formatDateYMD(automation);
        const delKey = formatDateYMD(delivery);

        if (launch >= start && launch <= end) addEventToMap(launchKey, "monthlyLaunch");
        if (automation >= start && automation <= end) addEventToMap(autoKey, "monthlyAutomation");
        if (delivery >= start && delivery <= end) addEventToMap(delKey, "monthlyDelivery");

        mo = addDays(mo, MONTHLY_INTERVAL);
      }
    }

    function renderCalendar() {
      const monthLabelEl = document.getElementById("calendarMonthLabel");
      const tbody = document.getElementById("calendarBody");
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      const year = currentMonthDate.getFullYear();
      const month = currentMonthDate.getMonth();

      monthLabelEl.textContent = currentMonthDate.toLocaleDateString(undefined, {
        month: "long",
        year: "numeric"
      });

      const firstOfMonth = new Date(year, month, 1);
      const lastOfMonth = new Date(year, month + 1, 0);
      firstOfMonth.setHours(0, 0, 0, 0);
      lastOfMonth.setHours(0, 0, 0, 0);

      // Start grid on the Sunday of the week containing the 1st
      const gridStart = new Date(firstOfMonth);
      while (gridStart.getDay() !== 0) {
        gridStart.setDate(gridStart.getDate() - 1);
      }

      // End grid after 5‚Äì6 weeks
      const gridEnd = new Date(gridStart);
      gridEnd.setDate(gridEnd.getDate() + 6 * 7 - 1);
      gridEnd.setHours(0, 0, 0, 0);

      buildCalendarEvents(gridStart, gridEnd);

      tbody.innerHTML = "";
      let current = new Date(gridStart);

      const todayKey = formatDateYMD(today);
      let defaultSelectedKey = todayKey;

      if (today < firstOfMonth || today > lastOfMonth) {
        defaultSelectedKey = formatDateYMD(firstOfMonth);
      }

      for (let week = 0; week < 6; week++) {
        const tr = document.createElement("tr");
        for (let dow = 0; dow < 7; dow++) {
          const td = document.createElement("td");
          const cellDate = new Date(current);
          const cellKey = formatDateYMD(cellDate);
          const cellMonth = cellDate.getMonth();

          const cellDiv = document.createElement("div");
          cellDiv.classList.add("calendar-cell");
          if (cellMonth !== month) {
            cellDiv.classList.add("calendar-cell--other");
          }
          if (cellKey === todayKey) {
            cellDiv.classList.add("calendar-cell--today");
          }
          cellDiv.dataset.dateKey = cellKey;

          const dayNumber = document.createElement("div");
          dayNumber.classList.add("calendar-day-number");
          dayNumber.textContent = cellDate.getDate();

          const dotsDiv = document.createElement("div");
          dotsDiv.classList.add("calendar-dots");

          const events = calendarEventsMap[cellKey] || [];
          const usedTypes = new Set();
          events.forEach(ev => {
            if (usedTypes.has(ev.type)) return; // avoid duplicate dots per type
            usedTypes.add(ev.type);
            const dot = document.createElement("span");
            dot.classList.add("calendar-dot");
            if (ev.dotClass) dot.classList.add(ev.dotClass);
            dotsDiv.appendChild(dot);
          });

          cellDiv.appendChild(dayNumber);
          cellDiv.appendChild(dotsDiv);

          cellDiv.addEventListener("click", () => {
            selectCalendarDate(cellKey);
          });

          td.appendChild(cellDiv);
          tr.appendChild(td);

          current.setDate(current.getDate() + 1);
        }
        tbody.appendChild(tr);
      }

      // Auto-select default day
      selectCalendarDate(defaultSelectedKey);
    }

    function selectCalendarDate(dateKey) {
      const tbody = document.getElementById("calendarBody");
      if (!tbody) return;

      // Clear previous selection
      const prevSelected = tbody.querySelector(".calendar-cell--selected");
      if (prevSelected) {
        prevSelected.classList.remove("calendar-cell--selected");
      }

      const cell = tbody.querySelector('[data-date-key="' + dateKey + '"]');
      if (cell) {
        cell.classList.add("calendar-cell--selected");
      }

      const detailsEl = document.getElementById("calendarDetails");
      const titleEl = detailsEl.querySelector(".calendar-details-title");
      const bodyEl = detailsEl.querySelector(".calendar-details-body");

      const [year, month, day] = dateKey.split("-").map(Number);
      const dateObj = new Date(year, month - 1, day);
      const niceDate = dateObj.toLocaleDateString(undefined, {
        weekday: "long",
        year: "numeric",
        month: "short",
        day: "numeric"
      });

      titleEl.textContent = "Events on " + niceDate;

      const events = calendarEventsMap[dateKey] || [];
      if (!events.length) {
        bodyEl.textContent = "No launches, automations, or deliveries on this day.";
        return;
      }

      let html = "<ul>";
      events.forEach(ev => {
        html += "<li>" + ev.label + "</li>";
      });
      html += "</ul>";
      bodyEl.innerHTML = html;
    }

    function initCalendar() {
      const now = new Date();
      now.setHours(0, 0, 0, 0);
      currentMonthDate = new Date(now.getFullYear(), now.getMonth(), 1);
      const prevBtn = document.getElementById("prevMonthBtn");
      const nextBtn = document.getElementById("nextMonthBtn");

      prevBtn.addEventListener("click", () => {
        currentMonthDate = new Date(
          currentMonthDate.getFullYear(),
          currentMonthDate.getMonth() - 1,
          1
        );
        renderCalendar();
      });

      nextBtn.addEventListener("click", () => {
        currentMonthDate = new Date(
          currentMonthDate.getFullYear(),
          currentMonthDate.getMonth() + 1,
          1
        );
        renderCalendar();
      });

      renderCalendar();
    }

    // ---- MAIN RESULTS HANDLER ----

    document.getElementById("calcBtn").addEventListener("click", function () {
      const errorBox = document.getElementById("errorBox");
      const resultsBox = document.getElementById("resultsBox");
      const tbody = document.getElementById("resultsTableBody");

      errorBox.style.display = "none";
      errorBox.textContent = "";
      resultsBox.style.display = "none";
      tbody.innerHTML = "";

      const todayStr = document.getElementById("todayInput").value;
      const today = parseLocalDate(todayStr);

      if (!today) {
        errorBox.textContent = "Please enter a valid value for today‚Äôs date.";
        errorBox.style.display = "block";
        return;
      }

      const batches = [];

      // Weekly
      const weeklyNext = getNextWeeklyLaunch(today);
      batches.push({
        name: "Weekly batch",
        nextLaunch: weeklyNext
      });

      // Bi-weekly
      const biNext = getNextCycleLaunch(today, BIWEEKLY_ANCHOR, BIWEEKLY_INTERVAL);
      batches.push({
        name: "Bi-weekly batch",
        nextLaunch: biNext
      });

      // Monthly (28-day)
      const monthlyNext = getNextCycleLaunch(today, MONTHLY_ANCHOR, MONTHLY_INTERVAL);
      batches.push({
        name: "28-day ‚Äúmonthly‚Äù batch",
        nextLaunch: monthlyNext
      });

      batches.forEach(batch => {
        const daysUntil = diffInDays(today, batch.nextLaunch);

        let statusClass = "status-upcoming";
        let statusText = "Upcoming";

        if (daysUntil === 0) {
          statusClass = "status-today";
          statusText = "Launch today";
        } else if (daysUntil < 0) {
          statusClass = "status-past";
          statusText = "Already passed";
        }

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${batch.name}</td>
          <td>${formatNiceDate(batch.nextLaunch)}</td>
          <td>${getDayName(batch.nextLaunch)}</td>
          <td>${daysUntil}</td>
          <td>
            <span class="status-pill ${statusClass}">
              ${statusText}
            </span>
          </td>
        `;
        tbody.appendChild(tr);
      });

      resultsBox.style.display = "block";
    });

    // ---- INIT ----

    setDefaultToday();
    initTodayButton();
    initTheme();
    initCalendar();
  </script>
</body>
</html>
